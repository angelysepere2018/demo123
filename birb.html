<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kiwi the Green Parrot ‚Äì Seeds Game</title>
  <style>
    :root{--bg:#e7f8ff;--sky:#bfe9ff;--ground:#d8f3dc;--ui:#0f172a;--accent:#16a34a}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{display:grid;place-items:center;background:linear-gradient(180deg,var(--sky) 0%, var(--bg) 40%);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji;color:var(--ui)}
    .wrap{width:min(960px,100%);padding:12px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px}
    h1{font-size:clamp(20px,3.4vw,28px);margin:0;display:flex;gap:8px;align-items:center}
    h1 span{font-size:1.05em}
    .panel{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .btn{border:none;border-radius:999px;padding:10px 14px;font-weight:700;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.08);cursor:pointer}
    .btn:hover{transform:translateY(-1px)}
    .hud{display:flex;gap:18px;align-items:center}
    .tag{background:#fff;border-radius:999px;padding:6px 10px;box-shadow:0 2px 6px rgba(0,0,0,.08)}
    canvas{width:100%;height:auto;border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,.15);background:#c2f2ff;display:block}
    .controls{display:grid;grid-template-columns:repeat(3,64px);grid-template-rows:repeat(2,64px);gap:10px;justify-content:center;margin-top:10px;user-select:none}
    .dpad button{width:64px;height:64px;border-radius:14px;border:none;background:#ffffffcc;backdrop-filter: blur(6px);box-shadow:0 2px 8px rgba(0,0,0,.12);font-size:24px}
    .dpad{display:none}
    @media (max-width:700px){.dpad{display:grid}}
    .small{opacity:.8;font-size:.92rem}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ü¶ú Kiwi the Green Parrot <span>‚Äì snack time!</span></h1>
      <div class="panel">
        <button class="btn" id="startBtn">‚ñ∂Ô∏è Start</button>
        <button class="btn" id="pauseBtn">‚è∏Ô∏è Pause</button>
        <button class="btn" id="resetBtn">üîÑ Reset</button>
      </div>
      <div class="hud">
        <div class="tag" id="scoreTag">Score: 0</div>
        <div class="tag" id="timerTag">Time: 60</div>
        <div class="tag" id="livesTag">Lives: 3</div>
      </div>
    </header>

    <canvas id="game" width="960" height="540" aria-label="Kiwi the green parrot seeds game" role="img"></canvas>

    <div class="dpad controls" aria-hidden="false">
      <div></div>
      <button id="up">‚¨ÜÔ∏è</button>
      <div></div>
      <button id="left">‚¨ÖÔ∏è</button>
      <button id="down">‚¨áÔ∏è</button>
      <button id="right">‚û°Ô∏è</button>
    </div>

    <p class="small">Desktop: arrow keys or WASD to move. Mobile: use the on‚Äëscreen arrows. Help Kiwi eat seeds (üå∞) to score. Avoid chili peppers (üå∂Ô∏è)! Catch a star (‚≠ê) for bonus.</p>
  </div>

  <script>
  (function(){
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    // Handle high-DPI screens and ensure a reasonable fallback width
    function fitHiDPI(){
      const ratio = window.devicePixelRatio || 1;
      // fallback to a default width if clientWidth is 0 (sometimes happens when file is opened locally)
      const cssW = Math.max(1, canvas.clientWidth) || 960;
      const cssH = Math.round(cssW * 9 / 16);
      canvas.style.height = cssH + 'px';
      canvas.width = Math.round(cssW * ratio);
      canvas.height = Math.round(cssH * ratio);
      ctx.setTransform(ratio,0,0,ratio,0,0);
    }
    // Observe resizes but also run once after a short delay to be safe
    new ResizeObserver(fitHiDPI).observe(canvas);
    fitHiDPI();
    setTimeout(fitHiDPI, 200);

    // Game state
    const G = { running:false, paused:false, time:60, last:0, score:0, lives:3, seeds:[], hazards:[], sparkles:[], spawnSeedCd:0, spawnHazCd:0, spawnStarCd:10 };

    const pressed = {ArrowUp:false,ArrowDown:false,ArrowLeft:false,ArrowRight:false,KeyW:false,KeyA:false,KeyS:false,KeyD:false};

    // Kiwi (player) ‚Äî will be drawn as a green bird on canvas now
    const player = { x: canvas.width/2/(window.devicePixelRatio||1), y: canvas.height/2/(window.devicePixelRatio||1), r: 20, speed:240, vx:0, vy:0, name:'Kiwi' };

    // UI elements
    const scoreTag = document.getElementById('scoreTag');
    const timerTag = document.getElementById('timerTag');
    const livesTag = document.getElementById('livesTag');

    // Input
    window.addEventListener('keydown', e=>{ if(pressed[e.code]!==undefined){ pressed[e.code]=true; e.preventDefault(); } });
    window.addEventListener('keyup', e=>{ if(pressed[e.code]!==undefined){ pressed[e.code]=false; e.preventDefault(); } });

    ['up','down','left','right'].forEach(id=>{
      const b = document.getElementById(id);
      if(!b) return;
      ['pointerdown','mousedown','touchstart'].forEach(ev=> b.addEventListener(ev, e=>{ if(id==='up') pressed.ArrowUp=true; if(id==='down') pressed.ArrowDown=true; if(id==='left') pressed.ArrowLeft=true; if(id==='right') pressed.ArrowRight=true; e.preventDefault(); }));
      ['pointerup','mouseup','mouseleave','touchend','touchcancel'].forEach(ev=> b.addEventListener(ev, e=>{ if(id==='up') pressed.ArrowUp=false; if(id==='down') pressed.ArrowDown=false; if(id==='left') pressed.ArrowLeft=false; if(id==='right') pressed.ArrowRight=false; e.preventDefault(); }));
    });

    // Helpers
    const rand = (a,b)=> Math.random()*(b-a)+a;
    const clamp = (v,a,b)=> Math.max(a, Math.min(b, v));
    const dist = (x1,y1,x2,y2)=> Math.hypot(x1-x2, y1-y2);

    function reset(){
      G.running=false; G.paused=false; G.time=60; G.score=0; G.lives=3; G.seeds.length=0; G.hazards.length=0; G.sparkles.length=0; G.spawnSeedCd=0; G.spawnHazCd=0; G.spawnStarCd=10;
      player.x = canvas.width/2/(window.devicePixelRatio||1);
      player.y = canvas.height*0.7/(window.devicePixelRatio||1);
    }

    function start(){ if(!G.running){ G.running = true; G.paused = false; G.last = performance.now(); requestAnimationFrame(loop); } }
    function pause(){ G.paused = !G.paused; }

    document.getElementById('startBtn').onclick = start;
    document.getElementById('pauseBtn').onclick = ()=> pause();
    document.getElementById('resetBtn').onclick = ()=>{ reset(); draw(); };

    // Entities
    function spawnSeed(){ G.seeds.push({x:rand(20, canvas.width/(window.devicePixelRatio||1)-20), y:-20, r:14, vy:rand(60,120), emoji:'üå∞', score:10}); }
    function spawnHazard(){ G.hazards.push({x:rand(20, canvas.width/(window.devicePixelRatio||1)-20), y:-20, r:16, vy:rand(90,150), emoji:'üå∂Ô∏è'}); }
    function spawnStar(){ const dir = Math.random()<0.5?-1:1; G.seeds.push({x: dir<0? canvas.width/(window.devicePixelRatio||1)+20 : -20, y:rand(80,260), r:16, vy:0, vx:dir*rand(90,130), emoji:'‚≠ê', score:30}); }

    function eatFX(x,y){ for(let i=0;i<8;i++){ G.sparkles.push({x,y, vx:rand(-80,80), vy:rand(-140,-40), g:320, life:0.6}); } }

    function update(dt){
      if(!G.running || G.paused) return;
      G.time -= dt; if(G.time < 0){ G.time = 0; gameOver(); }

      // movement
      const up = pressed.ArrowUp || pressed.KeyW;
      const dn = pressed.ArrowDown || pressed.KeyS;
      const lf = pressed.ArrowLeft || pressed.KeyA;
      const rt = pressed.ArrowRight || pressed.KeyD;
      let ax = (rt?1:0) - (lf?1:0);
      let ay = (dn?1:0) - (up?1:0);
      const mag = Math.hypot(ax,ay) || 1; ax/=mag; ay/=mag;
      player.vx = ax * player.speed; player.vy = ay * player.speed;
      player.x = clamp(player.x + player.vx*dt, player.r, canvas.width/(window.devicePixelRatio||1)-player.r);
      player.y = clamp(player.y + player.vy*dt, player.r, canvas.height/(window.devicePixelRatio||1)-player.r);

      // spawn logic
      G.spawnSeedCd -= dt; if(G.spawnSeedCd <= 0){ spawnSeed(); G.spawnSeedCd = rand(0.4,0.9); }
      G.spawnHazCd  -= dt; if(G.spawnHazCd  <= 0){ spawnHazard(); G.spawnHazCd = rand(1.3,2.4); }
      G.spawnStarCd -= dt; if(G.spawnStarCd <= 0){ spawnStar(); G.spawnStarCd = rand(8,14); }

      // update entities
      for(const s of G.seeds){ s.y += (s.vy||0)*dt; if(s.vx) s.x += s.vx*dt; }
      for(const h of G.hazards){ h.y += h.vy*dt; }

      // cleanup
      G.seeds = G.seeds.filter(s=> s.y < canvas.height/(window.devicePixelRatio||1)+30 && s.x>-40 && s.x<canvas.width/(window.devicePixelRatio||1)+40);
      G.hazards = G.hazards.filter(h=> h.y < canvas.height/(window.devicePixelRatio||1)+30);

      // collisions
      for(let i=G.seeds.length-1;i>=0;i--){ const s = G.seeds[i]; if(dist(player.x,player.y,s.x,s.y) < player.r + s.r){ G.score += s.score; eatFX(s.x,s.y); G.seeds.splice(i,1); } }
      for(let i=G.hazards.length-1;i>=0;i--){ const h = G.hazards[i]; if(dist(player.x,player.y,h.x,h.y) < player.r + h.r){ G.hazards.splice(i,1); G.lives -= 1; screenShake(10); if(G.lives<=0) gameOver(); } }

      // sparkles
      for(const p of G.sparkles){ p.vy += p.g*dt; p.x += p.vx*dt; p.y += p.vy*dt; p.life -= dt; }
      G.sparkles = G.sparkles.filter(p=> p.life>0);

      // HUD
      scoreTag.textContent = `Score: ${G.score}`;
      timerTag.textContent = `Time: ${Math.ceil(G.time)}`;
      livesTag.textContent = `Lives: ${G.lives}`;
    }

    // Screen shake
    let shakeTime = 0, shakeMag = 0;
    function screenShake(mag){ shakeTime = 0.25; shakeMag = mag; }

    // Draw kiwi as a green bird (canvas shapes) instead of emoji to ensure color consistency
    function drawKiwi(x,y,r){
      ctx.save(); ctx.translate(x,y);
      // body
      ctx.beginPath(); ctx.ellipse(0, 0, r*1.1, r*1.2, 0, 0, Math.PI*2); ctx.fillStyle = '#2db34a'; ctx.fill();
      // darker wing
      ctx.beginPath(); ctx.ellipse(-r*0.15, 0, r*0.6, r*0.38, -0.5, 0, Math.PI*2); ctx.fillStyle = '#1f8f38'; ctx.fill();
      // belly highlight
      ctx.beginPath(); ctx.ellipse(r*0.05, r*0.15, r*0.55, r*0.47, 0.2, 0, Math.PI*2); ctx.fillStyle = 'rgba(255,255,255,0.08)'; ctx.fill();
      // eye
      ctx.beginPath(); ctx.fillStyle = '#fff'; ctx.arc(r*0.38, -r*0.2, r*0.22, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.fillStyle = '#000'; ctx.arc(r*0.38, -r*0.2, r*0.08, 0, Math.PI*2); ctx.fill();
      // beak
      ctx.beginPath(); ctx.fillStyle = '#f7b731'; ctx.moveTo(r*0.7, 0); ctx.lineTo(r*1.2, -r*0.35); ctx.lineTo(r*1.0, 0); ctx.closePath(); ctx.fill();
      ctx.restore();
    }

    function draw(){
      const w = canvas.width/(window.devicePixelRatio||1);
      const h = canvas.height/(window.devicePixelRatio||1);
      // shake
      let ox=0, oy=0; if(shakeTime>0){ ox = rand(-shakeMag, shakeMag); oy = rand(-shakeMag, shakeMag); shakeTime -= 1/60; }

      ctx.save(); ctx.clearRect(0,0,canvas.width,canvas.height);
      // background
      const grd = ctx.createLinearGradient(0,0,0,h); grd.addColorStop(0,'#b9f3ff'); grd.addColorStop(1,'#dfffe6'); ctx.fillStyle = grd; ctx.fillRect(0,0,w,h);
      ctx.fillStyle = '#a7f3d0'; ctx.fillRect(0,h-60,w,60);
      ctx.translate(ox,oy);

      // draw seeds & hazards as emoji (ok to use emoji here)
      ctx.font = '24px Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji, system-ui'; ctx.textAlign='center'; ctx.textBaseline='middle';
      for(const s of G.seeds) ctx.fillText(s.emoji, s.x, s.y);
      for(const hzd of G.hazards) ctx.fillText(hzd.emoji, hzd.x, hzd.y);

      // Kiwi
      const bob = Math.sin(performance.now()/200)*2;
      // shadow
      ctx.globalAlpha = 0.25; ctx.beginPath(); ctx.ellipse(player.x, player.y+player.r+6, player.r*0.9, 6, 0, 0, Math.PI*2); ctx.fillStyle = '#000'; ctx.fill(); ctx.globalAlpha = 1;
      drawKiwi(player.x, player.y + bob, player.r);

      // sparkles
      ctx.globalAlpha = 0.9; for(const p of G.sparkles) ctx.fillText('‚ú®', p.x, p.y); ctx.globalAlpha = 1;

      // overlays
      if(!G.running){ drawCenterText('ü¶ú Kiwi is hungry!','Press Start to Play'); }
      else if(G.paused){ drawCenterText('Paused','Press Pause to Resume'); }
      else if(G.time<=0 || G.lives<=0){ drawCenterText(`Game Over ‚Äì Score ${G.score}`, 'Press Reset to help Kiwi try again'); }

      ctx.restore();
    }

    function drawCenterText(title, subtitle){ const w = canvas.width/(window.devicePixelRatio||1); const h = canvas.height/(window.devicePixelRatio||1); ctx.fillStyle='rgba(255,255,255,.92)'; ctx.fillRect(w*0.1,h*0.28,w*0.8, h*0.28); ctx.strokeStyle='rgba(0,0,0,.08)'; ctx.lineWidth=2; ctx.strokeRect(w*0.1,h*0.28,w*0.8, h*0.28); ctx.fillStyle='#0f172a'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.font='bold 32px system-ui'; ctx.fillText(title, w/2, h*0.37); ctx.font='18px system-ui'; ctx.fillText(subtitle, w/2, h*0.47); }

    function loop(now){ const dt = Math.min(0.033, (now - G.last)/1000 || 0); G.last = now; if(!G.paused){ update(dt); } draw(); if(G.running) requestAnimationFrame(loop); }

    function gameOver(){ G.running = false; }

    // Start-up: reset and draw once. Auto-start to help if the Start button didn't work for you.
    reset(); draw();
    // Try auto-start after a short delay so layout settles ‚Äî helpful if the game felt like "not running".
    setTimeout(()=>{ if(!G.running) start(); }, 250);

  })();
  </script>
</body>
</html>
